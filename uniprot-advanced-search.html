<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="uniprot-tree-select.html">
<link rel="import" href="uniprot-styling.html">

<!--
`uniprot-advanced-search`
Advanced search component for UniProt

@demo demo/uniprot-advanced-search-demo.html
-->

<dom-module id="uniprot-advanced-search">
  <template>
    <style include="uniprot-styling"></style>
    <uniprot-tree-select data="[[data.members]]" slot="dropdown-content"></uniprot-tree-select>
    <paper-input label="Search" value="{{input}}"> </paper-input>
    <ul>
      <template is="dom-repeat" items="{{paths}}">
          <li><a>{{item}}</a></li>
      </template>
    </ul>
  </template>

  <script>
    Polymer({

      is: 'uniprot-advanced-search',

      properties: {
        data: {
          type: Object
        }, input: {
          type: String,
          observer: '_findInPath'
        }, paths: {
          type: Array
        }
      },

      _findPathsInTree(members, searchTerm, paths, currentPath) {
        for (let member of members) {
          let newPath = '';
          if(currentPath.length <= 0) {
            newPath = `${member.label}`;
          } else {
            newPath = `${currentPath} > ${member.label}`;
          }
          // Leaf node
          if(!member.members) {
              if(newPath.toLowerCase().indexOf(searchTerm.toLowerCase()) > 0){
                paths.push(newPath);
              }
          } else if (member.members && member.members.length > 0) {
            this._findPathsInTree(member.members, searchTerm, paths, newPath);
          }
        }
      },

      _findInPath(newValue, oldValue) {
        if(this.data) {
          // hide dropdown, show autocomplete
          let paths = [];
          this._findPathsInTree(this.data.members, newValue, paths, '');
          this.paths = paths;
        }
      }

    });
  </script>
</dom-module>
